@repo/shifts-service test: bun test v1.3.4 (5eb2145b)
@repo/shifts-service test: 
@repo/shifts-service test: tests/sprint_3_pagination.test.ts:
@repo/shifts-service test: (pass) WH-115: History Pagination > passes limit and offset to database query [0.69ms]
@repo/shifts-service test: (pass) WH-115: History Pagination > handles default/zero values correctly [0.13ms]
@repo/shifts-service test: 
@repo/shifts-service test: tests/publish.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'publishScheduleController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/publish.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/calculations.test.ts:
@repo/shifts-service test: (pass) calculateShiftPay > calculates pay for exact hours
@repo/shifts-service test: (pass) calculateShiftPay > calculates pay for partial hours (rounding up preference)
@repo/shifts-service test: (pass) calculateShiftPay > handles partial cents correctly (ceil)
@repo/shifts-service test: (pass) calculateShiftPay > returns 0 for zero or negative time
@repo/shifts-service test: (pass) calculateShiftPay > returns 0 for zero rate
@repo/shifts-service test: 
@repo/shifts-service test: tests/upcoming.test.ts:
@repo/shifts-service test: 21 | 
@repo/shifts-service test: 22 | 
@repo/shifts-service test: 23 | describe("GET /shifts/upcoming", () => {
@repo/shifts-service test: 24 |     test("returns 200 OK", async () => {
@repo/shifts-service test: 25 |         const response = await getUpcomingShifts("test_org");
@repo/shifts-service test: 26 |         expect(response.status).toBe(200);
@repo/shifts-service test:                                      ^
@repo/shifts-service test: error: expect(received).toBe(expected)
@repo/shifts-service test: 
@repo/shifts-service test: Expected: 200
@repo/shifts-service test: Received: undefined
@repo/shifts-service test: 
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/upcoming.test.ts:26:33)
@repo/shifts-service test: (fail) GET /shifts/upcoming > returns 200 OK [1.51ms]
@repo/shifts-service test: 26 |         expect(response.status).toBe(200);
@repo/shifts-service test: 27 |     });
@repo/shifts-service test: 28 | 
@repo/shifts-service test: 29 |     test("returns only active shifts (not completed/cancelled)", async () => {
@repo/shifts-service test: 30 |         const response = await getUpcomingShifts("test_org");
@repo/shifts-service test: 31 |         const shifts = await response.json() as any[];
@repo/shifts-service test:                                            ^
@repo/shifts-service test: TypeError: (await getUpcomingShifts("test_org")).json is not a function. (In '(await getUpcomingShifts("test_org")).json()', '(await getUpcomingShifts("test_org")).json' is undefined)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/upcoming.test.ts:31:39)
@repo/shifts-service test: (fail) GET /shifts/upcoming > returns only active shifts (not completed/cancelled) [0.21ms]
@repo/shifts-service test: 40 |         expect(invalidShifts.length).toBe(0);
@repo/shifts-service test: 41 |     });
@repo/shifts-service test: 42 | 
@repo/shifts-service test: 43 |     test("sorts by startTime ascending", async () => {
@repo/shifts-service test: 44 |         const response = await getUpcomingShifts("test_org");
@repo/shifts-service test: 45 |         const shifts = await response.json() as any[];
@repo/shifts-service test:                                            ^
@repo/shifts-service test: TypeError: (await getUpcomingShifts("test_org")).json is not a function. (In '(await getUpcomingShifts("test_org")).json()', '(await getUpcomingShifts("test_org")).json' is undefined)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/upcoming.test.ts:45:39)
@repo/shifts-service test: (fail) GET /shifts/upcoming > sorts by startTime ascending [0.15ms]
@repo/shifts-service test: 
@repo/shifts-service test: tests/middleware.test.ts:
@repo/shifts-service test: (pass) Middleware Verification > WH-113: Adds X-Request-ID header [2.14ms]
@repo/shifts-service test: 18 |         const app = new Hono();
@repo/shifts-service test: 19 |         app.use("*", requestId());
@repo/shifts-service test: 20 |         app.onError((err, c) => errorHandler(err, c)); // Fix type mismatch if needs cast?
@repo/shifts-service test: 21 | 
@repo/shifts-service test: 22 |         app.get("/error", () => {
@repo/shifts-service test: 23 |             throw new AppError("Test Error", "TEST_CODE", 400, { foo: "bar" });
@repo/shifts-service test:                        ^
@repo/shifts-service test: AppError: Test Error
@repo/shifts-service test:  statusCode: 400,
@repo/shifts-service test:     details: {
@repo/shifts-service test:   foo: "bar",
@repo/shifts-service test: },
@repo/shifts-service test:        code: "TEST_CODE"
@repo/shifts-service test: 
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/middleware.test.ts:23:19)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:22:23)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:6:32)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/observability/src/index.ts:74:11)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/observability/src/index.ts:69:39)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:22:23)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:6:32)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/hono-base.js:301:31)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/hono-base.js:299:13)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/middleware.test.ts:26:31)
@repo/shifts-service test: 
@repo/shifts-service test: (pass) Middleware Verification > WH-112: Standardizes AppError response [0.62ms]
@repo/shifts-service test: 38 |         const app = new Hono();
@repo/shifts-service test: 39 |         app.use("*", requestId());
@repo/shifts-service test: 40 |         app.onError((err, c) => errorHandler(err, c));
@repo/shifts-service test: 41 | 
@repo/shifts-service test: 42 |         app.get("/panic", () => {
@repo/shifts-service test: 43 |             throw new Error("Something exploded");
@repo/shifts-service test:                            ^
@repo/shifts-service test: error: Something exploded
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/middleware.test.ts:43:23)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:22:23)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:6:32)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/observability/src/index.ts:74:11)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/observability/src/index.ts:69:39)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:22:23)
@repo/shifts-service test:       at dispatch (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/compose.js:6:32)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/hono-base.js:301:31)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/node_modules/.bun/hono@4.11.7/node_modules/hono/dist/hono-base.js:299:13)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/middleware.test.ts:46:31)
@repo/shifts-service test: 
@repo/shifts-service test: (pass) Middleware Verification > WH-112: Catch generic Error as 500 [0.22ms]
@repo/shifts-service test: 
@repo/shifts-service test: tests/history.test.ts:
@repo/shifts-service test:  6 |     // Tests disabled as they rely on mock-db which was replaced by Drizzle.
@repo/shifts-service test:  7 |     // Real integration tests require DB seeding.
@repo/shifts-service test:  8 | 
@repo/shifts-service test:  9 |     test("returns history shifts response", async () => {
@repo/shifts-service test: 10 |         const response = await getHistoryShifts("test_org", { limit: 10, offset: 0 });
@repo/shifts-service test: 11 |         expect(response.status).toBe(200);
@repo/shifts-service test:                                      ^
@repo/shifts-service test: error: expect(received).toBe(expected)
@repo/shifts-service test: 
@repo/shifts-service test: Expected: 200
@repo/shifts-service test: Received: undefined
@repo/shifts-service test: 
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/history.test.ts:11:33)
@repo/shifts-service test: (fail) GET /shifts/history > returns history shifts response [0.27ms]
@repo/shifts-service test: 
@repo/shifts-service test: tests/sprint_3_ghost_shifts.test.ts:
@repo/shifts-service test: 42 |             location: {}
@repo/shifts-service test: 43 |         };
@repo/shifts-service test: 44 |         shifts.push(shift4h);
@repo/shifts-service test: 45 | 
@repo/shifts-service test: 46 |         const res = await getPendingShifts("org_1");
@repo/shifts-service test: 47 |         const data = await res.json() as any[];
@repo/shifts-service test:                                     ^
@repo/shifts-service test: TypeError: (await getPendingShifts("org_1")).json is not a function. (In '(await getPendingShifts("org_1")).json()', '(await getPendingShifts("org_1")).json' is undefined)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/sprint_3_ghost_shifts.test.ts:47:32)
@repo/shifts-service test: (fail) WH-114: Ghost Shift Tuning > 4h shift uses 2h minimum buffer [0.32ms]
@repo/shifts-service test: 70 |             location: {}
@repo/shifts-service test: 71 |         };
@repo/shifts-service test: 72 |         shifts.push(shift12h);
@repo/shifts-service test: 73 | 
@repo/shifts-service test: 74 |         const res = await getPendingShifts("org_1");
@repo/shifts-service test: 75 |         const data = await res.json() as any[];
@repo/shifts-service test:                                     ^
@repo/shifts-service test: TypeError: (await getPendingShifts("org_1")).json is not a function. (In '(await getPendingShifts("org_1")).json()', '(await getPendingShifts("org_1")).json' is undefined)
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/sprint_3_ghost_shifts.test.ts:75:32)
@repo/shifts-service test: (fail) WH-114: Ghost Shift Tuning > 12h shift uses 3h buffer (25%) [0.06ms]
@repo/shifts-service test: 
@repo/shifts-service test: tests/state-machine.test.ts:
@repo/shifts-service test: (pass) Shift State Machine > allows valid normal flow [0.11ms]
@repo/shifts-service test: (pass) Shift State Machine > allows cancellation from almost anywhere [0.03ms]
@repo/shifts-service test: 16 |     });
@repo/shifts-service test: 17 | 
@repo/shifts-service test: 18 |     it("prevents skipping steps", () => {
@repo/shifts-service test: 19 |         expect(() => validateShiftTransition('published', 'in-progress')).toThrow();
@repo/shifts-service test: 20 |         expect(() => validateShiftTransition('assigned', 'completed')).toThrow();
@repo/shifts-service test: 21 |         expect(() => validateShiftTransition('assigned', 'approved')).toThrow();
@repo/shifts-service test:                                                                            ^
@repo/shifts-service test: error: expect(received).toThrow()
@repo/shifts-service test: 
@repo/shifts-service test: Received function did not throw
@repo/shifts-service test: Received value: undefined
@repo/shifts-service test: 
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/state-machine.test.ts:21:71)
@repo/shifts-service test: (fail) Shift State Machine > prevents skipping steps [0.07ms]
@repo/shifts-service test: (pass) Shift State Machine > prevents back-flow [0.04ms]
@repo/shifts-service test: 
@repo/shifts-service test: tests/sprint_3_timesheet_status.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'getShiftTimesheetsController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/get-timesheets.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/sprint_4_overlap.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'publishScheduleController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/publish.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/sprint_3_crew_search.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'getCrewController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/get-crew.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/sprint_4_audit_no_show.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'approveShiftController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/approve.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/pending.test.ts:
@repo/shifts-service test: 22 |     // Tests disabled as they rely on mock-db which was replaced by Drizzle.
@repo/shifts-service test: 23 |     // Real integration tests require DB seeding.
@repo/shifts-service test: 24 | 
@repo/shifts-service test: 25 |     test("returns pending shifts response", async () => {
@repo/shifts-service test: 26 |         const response = await getPendingShifts("test_org");
@repo/shifts-service test: 27 |         expect(response.status).toBe(200);
@repo/shifts-service test:                                      ^
@repo/shifts-service test: error: expect(received).toBe(expected)
@repo/shifts-service test: 
@repo/shifts-service test: Expected: 200
@repo/shifts-service test: Received: undefined
@repo/shifts-service test: 
@repo/shifts-service test:       at <anonymous> (/Users/av/Documents/pavn/packages/shifts/tests/pending.test.ts:27:33)
@repo/shifts-service test: (fail) GET /shifts/pending-approval > returns pending shifts response [0.22ms]
@repo/shifts-service test: 
@repo/shifts-service test: tests/worker-shifts.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'getWorkerShiftsController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/worker-shifts.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/sprint_2_features.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'approveShiftController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/approve.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/wh126_break_enforcement.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'approveShiftController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/approve.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: tests/approve-race.test.ts:
@repo/shifts-service test: 
@repo/shifts-service test: # Unhandled error between tests
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 1 | })
@repo/shifts-service test: 2 | {
@repo/shifts-service test:     ^
@repo/shifts-service test: SyntaxError: Export named 'approveShiftController' not found in module '/Users/av/Documents/pavn/packages/shifts/src/services/approve.ts'.
@repo/shifts-service test:       at loadAndEvaluateModule (2:1)
@repo/shifts-service test: -------------------------------
@repo/shifts-service test: 
@repo/shifts-service test: 
@repo/shifts-service test: src/utils/recurrence.test.ts:
@repo/shifts-service test: (pass) expandRecurringDates > should return base dates if recurrence is disabled
@repo/shifts-service test: (pass) expandRecurringDates > should expand weekly recurrence for fixed weeks [1.80ms]
@repo/shifts-service test: (pass) expandRecurringDates > should expand biweekly recurrence [0.08ms]
@repo/shifts-service test: (pass) expandRecurringDates > should respect end date [0.10ms]
@repo/shifts-service test: (pass) expandRecurringDates > should generate multiple days per week [0.11ms]
@repo/shifts-service test: 
@repo/shifts-service test:  18 pass
@repo/shifts-service test:  17 fail
@repo/shifts-service test:  9 errors
@repo/shifts-service test:  44 expect() calls
@repo/shifts-service test: Ran 35 tests across 18 files. [122.00ms]
@repo/shifts-service test: Exited with code 1
